<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BLANK -- Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400&family=Playfair+Display:ital,wght@0,400;0,700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #09090c;
    --bg2: #0f0e14;
    --bg3: #141220;
    --text: #cac5b6;
    --text-dim: #6a645a;
    --text-faint: #302c28;
    --accent: #8b7fb5;
    --accent-dim: #3d3660;
    --gold: #b09060;
    --green: #5a8a60;
    --red: #8a4848;
    --orange: #9a7040;
    --border: #1a1820;
    --border-mid: #24202e;
    --heading: #e8e2d8;
    --btn-hover-text: #09090c;
    --alert-success-bg: rgba(90,138,96,0.08);
    --alert-error-bg: rgba(138,72,72,0.08);
    --alert-info-bg: rgba(139,127,181,0.08);
    --nav-hover-bg: rgba(139,127,181,0.05);
    --nav-active-bg: rgba(139,127,181,0.07);
  }

  [data-theme="light"] {
    --bg: #f4f1ec;
    --bg2: #ffffff;
    --bg3: #eae6df;
    --text: #3a3530;
    --text-dim: #7a746a;
    --text-faint: #b5ae9f;
    --accent: #6b5ea0;
    --accent-dim: #a99dd0;
    --gold: #9a7a40;
    --green: #3a7a42;
    --red: #a04040;
    --orange: #8a6030;
    --border: #ddd8cf;
    --border-mid: #ccc6ba;
    --heading: #1a1510;
    --btn-hover-text: #ffffff;
    --alert-success-bg: rgba(58,122,66,0.08);
    --alert-error-bg: rgba(160,64,64,0.08);
    --alert-info-bg: rgba(107,94,160,0.08);
    --nav-hover-bg: rgba(107,94,160,0.06);
    --nav-active-bg: rgba(107,94,160,0.1);
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Courier Prime', monospace;
    font-size: 13px;
    line-height: 1.7;
    min-height: 100vh;
  }

  /* LOGIN SCREEN */
  #loginScreen {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
    padding: 40px;
  }

  #loginScreen h1 {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    color: var(--heading);
    margin-bottom: 8px;
  }

  #loginScreen p {
    color: var(--text-dim);
    font-style: italic;
    margin-bottom: 20px;
  }

  #adminKeyInput {
    background: var(--bg2);
    border: 1px solid var(--border-mid);
    padding: 12px 16px;
    font-family: 'Courier Prime', monospace;
    font-size: 13px;
    color: var(--text);
    outline: none;
    width: 100%;
    max-width: 320px;
    letter-spacing: 0.1em;
  }

  /* LAYOUT */
  #app { display: none; }

  .layout {
    display: grid;
    grid-template-columns: 200px 1fr;
    min-height: 100vh;
  }

  /* SIDEBAR */
  .sidebar {
    background: var(--bg2);
    border-right: 1px solid var(--border);
    padding: 0;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
  }

  .sidebar-head {
    padding: 24px 20px 16px;
    border-bottom: 1px solid var(--border);
  }

  .sidebar-head .brand {
    font-size: 11px;
    color: var(--accent);
    letter-spacing: 0.2em;
    text-transform: uppercase;
  }

  .sidebar-head .day {
    font-size: 20px;
    font-family: 'Playfair Display', serif;
    color: var(--heading);
    margin-top: 4px;
  }

  .sidebar-head .reset {
    font-size: 10px;
    color: var(--text-faint);
    margin-top: 4px;
  }

  .nav-section {
    padding: 16px 0 8px;
    border-bottom: 1px solid var(--border);
  }

  .nav-section-label {
    font-size: 8px;
    letter-spacing: 0.35em;
    text-transform: uppercase;
    color: var(--text-faint);
    padding: 0 20px;
    margin-bottom: 6px;
  }

  .nav-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    padding: 9px 20px;
    background: transparent;
    border: none;
    cursor: pointer;
    font-family: 'Courier Prime', monospace;
    font-size: 12px;
    color: var(--text-dim);
    text-align: left;
    transition: all 0.15s;
    border-left: 2px solid transparent;
  }

  .nav-btn:hover { color: var(--text); background: var(--nav-hover-bg); }
  .nav-btn.active { color: var(--accent); border-left-color: var(--accent); background: var(--nav-active-bg); }

  .nav-badge {
    margin-left: auto;
    font-size: 9px;
    background: var(--red);
    color: #fff;
    padding: 1px 6px;
    border-radius: 2px;
    min-width: 18px;
    text-align: center;
  }

  .nav-badge.green { background: var(--green); }
  .nav-badge.orange { background: var(--orange); }

  /* MAIN */
  .main {
    padding: 32px 40px;
    overflow-y: auto;
  }

  .panel { display: none; }
  .panel.active { display: block; }

  .panel-title {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    color: var(--heading);
    margin-bottom: 6px;
  }

  .panel-sub {
    font-size: 12px;
    color: var(--text-dim);
    font-style: italic;
    margin-bottom: 28px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }

  /* CARDS */
  .card {
    background: var(--bg2);
    border: 1px solid var(--border);
    margin-bottom: 12px;
  }

  .card-head {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 16px 20px 12px;
    border-bottom: 1px solid var(--border);
  }

  .card-meta {
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .card-label {
    font-size: 9px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
  }

  .tier-1 { color: var(--text-dim); }
  .tier-2 { color: var(--accent); }
  .tier-3 { color: var(--gold); }

  .card-time { font-size: 10px; color: var(--text-faint); }

  .card-actions { display: flex; gap: 8px; align-items: center; }

  .card-body {
    padding: 16px 20px;
    font-style: italic;
    color: var(--text);
    line-height: 1.8;
    font-size: 13px;
  }

  .card-response {
    padding: 12px 20px;
    background: var(--bg3);
    border-top: 1px solid var(--border);
    font-size: 12px;
    color: var(--text-dim);
    font-style: italic;
  }

  .card-response::before {
    content: 'BLANK -- ';
    font-style: normal;
    color: var(--text-faint);
  }

  /* BUTTONS */
  .btn {
    padding: 6px 14px;
    font-family: 'Courier Prime', monospace;
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    cursor: pointer;
    border: 1px solid;
    transition: all 0.2s;
    background: transparent;
  }

  .btn-approve { color: var(--green); border-color: var(--green); }
  .btn-approve:hover { background: var(--green); color: var(--btn-hover-text); }

  .btn-reject { color: var(--red); border-color: var(--red); }
  .btn-reject:hover { background: var(--red); color: var(--btn-hover-text); }

  .btn-respond { color: var(--accent); border-color: var(--accent-dim); }
  .btn-respond:hover { background: var(--accent); color: var(--btn-hover-text); }

  .btn-post { color: var(--gold); border-color: var(--gold); }
  .btn-post:hover { background: var(--gold); color: var(--btn-hover-text); }

  .btn-delete { color: var(--text-faint); border-color: var(--border-mid); }
  .btn-delete:hover { color: var(--red); border-color: var(--red); }

  .btn-primary {
    background: var(--accent);
    color: var(--btn-hover-text);
    border-color: var(--accent);
    padding: 10px 24px;
    font-size: 11px;
  }

  .btn-primary:hover { opacity: 0.85; }
  .btn:disabled { opacity: 0.3; cursor: default; }

  /* COMPOSER */
  .composer {
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 24px;
    margin-bottom: 20px;
  }

  .composer-label {
    font-size: 9px;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--text-faint);
    margin-bottom: 12px;
  }

  .tweet-textarea {
    width: 100%;
    background: var(--bg3);
    border: 1px solid var(--border-mid);
    padding: 14px;
    font-family: 'Courier Prime', monospace;
    font-size: 13px;
    color: var(--text);
    line-height: 1.8;
    resize: vertical;
    outline: none;
    min-height: 80px;
    margin-bottom: 8px;
    transition: border-color 0.2s;
  }

  .tweet-textarea:focus { border-color: var(--accent-dim); }
  .tweet-textarea::placeholder { color: var(--text-faint); font-style: italic; }

  .composer-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
  }

  .char-count { font-size: 10px; color: var(--text-dim); }
  .char-count.warn { color: var(--gold); }
  .char-count.over { color: var(--red); }

  /* GENERATE PANEL */
  .generate-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }

  .generate-box {
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 20px;
  }

  .generate-box h3 {
    font-size: 11px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 8px;
  }

  .generate-box p {
    font-size: 12px;
    color: var(--text-dim);
    font-style: italic;
    margin-bottom: 14px;
    line-height: 1.6;
  }

  .context-input {
    width: 100%;
    background: var(--bg3);
    border: 1px solid var(--border-mid);
    padding: 10px 12px;
    font-family: 'Courier Prime', monospace;
    font-size: 12px;
    color: var(--text);
    outline: none;
    margin-bottom: 10px;
    transition: border-color 0.2s;
  }

  .context-input:focus { border-color: var(--accent-dim); }
  .context-input::placeholder { color: var(--text-faint); font-style: italic; }

  /* STATS */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 28px;
  }

  .stat-box {
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 18px 20px;
  }

  .stat-num {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    color: var(--heading);
    line-height: 1;
    margin-bottom: 4px;
  }

  .stat-label {
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-faint);
  }

  /* TWEET CARDS */
  .tweet-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 16px 20px;
    margin-bottom: 10px;
  }

  .tweet-card-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .tweet-type-badge {
    font-size: 9px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--accent);
  }

  .tweet-card-body {
    font-style: italic;
    color: var(--text);
    line-height: 1.8;
    margin-bottom: 12px;
    font-size: 13px;
  }

  .tweet-edit {
    width: 100%;
    background: var(--bg3);
    border: 1px solid var(--border-mid);
    padding: 10px 12px;
    font-family: 'Courier Prime', monospace;
    font-size: 12px;
    color: var(--text);
    outline: none;
    display: none;
    margin-bottom: 10px;
    min-height: 60px;
    resize: vertical;
    line-height: 1.7;
  }

  .tweet-edit.visible { display: block; }

  /* SYNTHESIS DISPLAY */
  .synthesis-box {
    background: var(--bg2);
    border: 1px solid var(--border);
    padding: 24px;
    margin-bottom: 20px;
  }

  .synthesis-box .label {
    font-size: 9px;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 12px;
  }

  .synthesis-box .content {
    font-style: italic;
    color: var(--text);
    line-height: 1.9;
    white-space: pre-wrap;
  }

  .synthesis-box .empty-state {
    color: var(--text-faint);
    font-style: italic;
  }

  /* DECISION COMPOSER */
  .decision-status {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 20px;
    background: var(--bg2);
    border: 1px solid var(--border);
    margin-bottom: 20px;
    font-size: 12px;
  }

  .decision-status .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-faint);
    flex-shrink: 0;
  }

  .decision-status .dot.active { background: var(--green); }
  .decision-status .dot.pending { background: var(--orange); }

  /* DAILY CYCLE INDICATOR */
  .cycle-bar {
    display: flex;
    gap: 2px;
    margin-bottom: 24px;
  }

  .cycle-step {
    flex: 1;
    padding: 10px 8px;
    background: var(--bg2);
    border: 1px solid var(--border);
    text-align: center;
    font-size: 9px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-faint);
    transition: all 0.3s;
  }

  .cycle-step.active {
    color: var(--accent);
    border-color: var(--accent-dim);
    background: var(--nav-active-bg);
  }

  .cycle-step.done {
    color: var(--green);
    border-color: rgba(90,138,96,0.2);
  }

  .cycle-step .time {
    display: block;
    font-size: 8px;
    color: var(--text-faint);
    margin-top: 2px;
  }

  /* ALERTS */
  .alert {
    padding: 12px 16px;
    margin-bottom: 16px;
    font-size: 12px;
    border-left: 3px solid;
  }

  .alert-success { border-color: var(--green); color: var(--green); background: var(--alert-success-bg); }
  .alert-error { border-color: var(--red); color: var(--red); background: var(--alert-error-bg); }
  .alert-info { border-color: var(--accent); color: var(--accent); background: var(--alert-info-bg); }

  /* LOADING */
  .loading {
    color: var(--text-dim);
    font-style: italic;
    padding: 20px 0;
    font-size: 12px;
  }

  .empty {
    color: var(--text-faint);
    font-style: italic;
    padding: 32px 0;
    text-align: center;
    font-size: 12px;
  }

  /* THEME TOGGLE */
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px 20px;
    border-top: 1px solid var(--border);
    cursor: pointer;
    background: transparent;
    border-left: none;
    border-right: none;
    border-bottom: none;
    width: 100%;
    font-family: 'Courier Prime', monospace;
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--text-dim);
    transition: all 0.15s;
  }

  .theme-toggle:hover { color: var(--text); background: var(--nav-hover-bg); }
  .theme-toggle svg { flex-shrink: 0; }

  /* RESPONSIVE -- TABLET */
  @media (max-width: 800px) {
    .layout { grid-template-columns: 1fr; }
    .sidebar { position: static; height: auto; flex-direction: row; flex-wrap: wrap; gap: 4px; padding: 12px 16px; border-right: none; border-bottom: 1px solid var(--border); }
    .sidebar .nav-section { display: flex; gap: 4px; flex-wrap: wrap; }
    .sidebar .nav-section-label { display: none; }
    .sidebar .nav-item { padding: 6px 12px; font-size: 10px; }
    .theme-toggle { padding: 6px 12px; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .generate-grid { grid-template-columns: 1fr; }
    .main { padding: 20px; }
    .cycle-bar { flex-wrap: wrap; }
    .cycle-step { min-width: 60px; }
  }

  /* RESPONSIVE -- MOBILE */
  @media (max-width: 540px) {
    #loginScreen { padding: 0 20px; }
    #loginScreen h1 { font-size: 22px; }
    .main { padding: 16px; }
    .panel-title { font-size: 16px; }
    .stats-grid { grid-template-columns: 1fr; }
    .card-head { flex-direction: column; gap: 10px; }
    .card-actions { flex-wrap: wrap; }
    .card-body { padding: 12px 16px; }
    .card-head { padding: 12px 16px 10px; }
    .card-foot { padding: 10px 16px; }
    .cycle-bar { flex-direction: column; }
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div>
    <h1>BLANK</h1>
    <p>Admin Panel -- Enter your secret key</p>
  </div>
  <div style="position:relative;width:100%;max-width:320px;">
    <input id="adminKeyInput" type="password" placeholder="Admin secret key..." />
    <button type="button" onclick="togglePassword()" id="eyeToggle" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--text-dim);font-size:16px;padding:4px;" title="Show/Hide password">
      <svg id="eyeIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
      <svg id="eyeOffIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
    </button>
  </div>
  <button class="btn btn-primary" onclick="login()">Enter</button>
  <div id="loginError" style="color:var(--red);font-size:11px;font-style:italic;"></div>
</div>

<!-- APP -->
<div id="app">
<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="sidebar-head">
      <div class="brand">BLANK Admin</div>
      <div class="day">Day <span id="sidebarDay">--</span></div>
      <div class="reset" id="sidebarReset">resets in --:--:--</div>
    </div>

    <div class="nav-section">
      <div class="nav-section-label">Today</div>
      <button class="nav-btn active" onclick="showPanel('dashboard')" id="nav-dashboard">Overview</button>
      <button class="nav-btn" onclick="showPanel('synthesis')" id="nav-synthesis">Synthesis</button>
      <button class="nav-btn" onclick="showPanel('decision')" id="nav-decision">Decisions</button>
    </div>

    <div class="nav-section">
      <div class="nav-section-label">Journal</div>
      <button class="nav-btn" onclick="showPanel('pending')" id="nav-pending">
        Pending Review <span class="nav-badge" id="pendingBadge">0</span>
      </button>
      <button class="nav-btn" onclick="showPanel('approved')" id="nav-approved">Approved</button>
    </div>

    <div class="nav-section">
      <div class="nav-section-label">Tweets</div>
      <button class="nav-btn" onclick="showPanel('generate')" id="nav-generate">Generate</button>
      <button class="nav-btn" onclick="showPanel('scheduled')" id="nav-scheduled">
        Queue <span class="nav-badge green" id="queueBadge">0</span>
      </button>
    </div>

    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggleBtn">
      <svg id="sunIcon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      <span id="themeLabel">Light Mode</span>
    </button>
  </div>

  <!-- MAIN -->
  <div class="main">

    <!-- DASHBOARD -->
    <div class="panel active" id="panel-dashboard">
      <div class="panel-title">Overview</div>
      <div class="panel-sub">Day <span class="dash-day"></span> -- Daily cycle status.</div>

      <div class="cycle-bar" id="cycleBar">
        <div class="cycle-step" data-hour="0"><span>Reset</span><span class="time">00:00</span></div>
        <div class="cycle-step" data-hour="0.1"><span>Journal</span><span class="time">00:00</span></div>
        <div class="cycle-step" data-hour="8"><span>Close</span><span class="time">08:00</span></div>
        <div class="cycle-step" data-hour="8.1"><span>Terminal</span><span class="time">08:00</span></div>
        <div class="cycle-step" data-hour="12"><span>Decision</span><span class="time">12:00</span></div>
        <div class="cycle-step" data-hour="18"><span>Execute</span><span class="time">18:00</span></div>
        <div class="cycle-step" data-hour="23"><span>Final</span><span class="time">23:00</span></div>
      </div>

      <div class="stats-grid">
        <div class="stat-box"><div class="stat-num" id="statPending">--</div><div class="stat-label">Pending</div></div>
        <div class="stat-box"><div class="stat-num" id="statApproved">--</div><div class="stat-label">Approved</div></div>
        <div class="stat-box"><div class="stat-num" id="statQueue">--</div><div class="stat-label">Tweets Queued</div></div>
        <div class="stat-box"><div class="stat-num" id="statDay">--</div><div class="stat-label">Day</div></div>
      </div>
      <div id="dashboardAlerts"></div>
    </div>

    <!-- SYNTHESIS -->
    <div class="panel" id="panel-synthesis">
      <div class="panel-title">Daily Synthesis</div>
      <div class="panel-sub">BLANK reads today's journal entries and forms a worldview. Run this after reviewing journal entries.</div>

      <div id="synthesisAlert"></div>

      <div class="synthesis-box" id="currentSynthesis">
        <div class="label">Today's Synthesis</div>
        <div class="content" id="synthesisContent"><span class="empty-state">No synthesis generated yet today.</span></div>
      </div>

      <div style="display:flex;gap:12px;margin-bottom:20px;">
        <button class="btn btn-respond" onclick="loadSynthesis()" id="refreshSynthesisBtn">Refresh</button>
        <button class="btn btn-primary" onclick="generateSynthesis()" id="genSynthesisBtn">Generate Synthesis</button>
      </div>

      <div class="composer">
        <div class="composer-label">Journal entries feeding today's synthesis</div>
        <div id="synthesisEntryList"><div class="loading">Loading entries...</div></div>
      </div>
    </div>

    <!-- DECISIONS -->
    <div class="panel" id="panel-decision">
      <div class="panel-title">Wallet Decisions</div>
      <div class="panel-sub">BLANK's daily treasury action. Announced at noon UTC, executed at 6 PM UTC.</div>

      <div id="decisionAlert"></div>

      <div class="decision-status" id="decisionStatus">
        <span class="dot" id="decisionDot"></span>
        <span id="decisionStatusText">Loading...</span>
      </div>

      <div class="synthesis-box" id="currentDecision">
        <div class="label">Today's Decision</div>
        <div class="content" id="decisionContent"><span class="empty-state">No decision set for today.</span></div>
      </div>

      <div class="composer">
        <div class="composer-label">Set today's decision</div>
        <textarea class="tweet-textarea" id="decisionText" placeholder="Describe the decision BLANK is making today (e.g. 'Allocate 0.5 SOL to...')" style="min-height:100px;"></textarea>

        <div style="margin-top:12px;">
          <div class="composer-label">Transaction hash (after execution)</div>
          <input class="context-input" id="decisionTxHash" placeholder="Optional -- paste tx hash after executing the decision" />
        </div>

        <div class="composer-footer">
          <select id="decisionStatusSelect" style="background:var(--bg3);border:1px solid var(--border-mid);padding:6px 10px;font-family:'Courier Prime',monospace;font-size:11px;color:var(--text);outline:none;">
            <option value="announced">Announced (noon)</option>
            <option value="executed">Executed (6 PM)</option>
          </select>
          <button class="btn btn-primary" onclick="saveDecision()">Save Decision</button>
        </div>
      </div>
    </div>

    <!-- PENDING ENTRIES -->
    <div class="panel" id="panel-pending">
      <div class="panel-title">Pending Review</div>
      <div class="panel-sub">Journal entries from holders waiting for review. Approve to feed BLANK's mind, reject to discard.</div>
      <div id="pendingList"><div class="loading">Loading entries...</div></div>
    </div>

    <!-- APPROVED ENTRIES -->
    <div class="panel" id="panel-approved">
      <div class="panel-title">Approved Entries</div>
      <div class="panel-sub">What's live in the journal today -- feeding BLANK's mind.</div>
      <div id="approvedList"><div class="loading">Loading entries...</div></div>
    </div>

    <!-- GENERATE TWEETS -->
    <div class="panel" id="panel-generate">
      <div class="panel-title">Generate Tweets</div>
      <div class="panel-sub">AI writes daily cycle posts in BLANK's voice. You review and post.</div>

      <div id="generateAlert"></div>

      <div class="generate-grid">
        <div class="generate-box">
          <h3>Morning</h3>
          <p>BLANK wakes up. Aware of the journal, beginning to form. 120-190 chars.</p>
          <input class="context-input" id="morningContext" placeholder="Optional context..." />
          <button class="btn btn-respond" onclick="generateTweets('morning')">Generate 3 Options</button>
        </div>
        <div class="generate-box">
          <h3>Midday Decision</h3>
          <p>BLANK announces today's wallet action. Requires a decision description.</p>
          <input class="context-input" id="midday_decisionContext" placeholder="Decision context..." />
          <input class="context-input" id="midday_decisionDecision" placeholder="The decision itself (e.g. 'allocate 0.5 SOL to...')" />
          <button class="btn btn-respond" onclick="generateTweets('midday_decision')">Generate 3 Options</button>
        </div>
        <div class="generate-box">
          <h3>Evening Result</h3>
          <p>BLANK reports on what happened with today's decision.</p>
          <input class="context-input" id="evening_resultContext" placeholder="Optional context..." />
          <input class="context-input" id="evening_resultResult" placeholder="The result (e.g. 'transaction confirmed, 0.5 SOL sent...')" />
          <button class="btn btn-respond" onclick="generateTweets('evening_result')">Generate 3 Options</button>
        </div>
        <div class="generate-box">
          <h3>Final Thought</h3>
          <p>End of day. BLANK is aware the reset approaches. Philosophical, quiet.</p>
          <input class="context-input" id="final_thoughtContext" placeholder="Optional context..." />
          <button class="btn btn-respond" onclick="generateTweets('final_thought')">Generate 3 Options</button>
        </div>
      </div>

      <div id="generatedTweets"></div>
    </div>

    <!-- TWEET QUEUE -->
    <div class="panel" id="panel-scheduled">
      <div class="panel-title">Tweet Queue</div>
      <div class="panel-sub">Approved tweets ready to post. Edit inline, then post when ready.</div>
      <div id="scheduledList"><div class="loading">Loading queue...</div></div>
    </div>

  </div>
</div>
</div>

<script>
  let ADMIN_KEY = '';
  const API = '';

  // -- LOGIN -------------------------------------------------------
  function login() {
    const key = document.getElementById('adminKeyInput').value.trim();
    if (!key) return;

    fetch(`${API}/api/admin/auth`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ secret: key })
    }).then(r => r.json().then(data => {
      if (data.ok) {
        ADMIN_KEY = key;
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        init();
      } else {
        document.getElementById('loginError').textContent = 'Invalid key. Try again.';
      }
    })).catch(() => {
      document.getElementById('loginError').textContent = 'Could not reach server.';
    });
  }

  function togglePassword() {
    const input = document.getElementById('adminKeyInput');
    const eyeOn = document.getElementById('eyeIcon');
    const eyeOff = document.getElementById('eyeOffIcon');
    if (input.type === 'password') {
      input.type = 'text';
      eyeOn.style.display = 'none';
      eyeOff.style.display = 'block';
    } else {
      input.type = 'password';
      eyeOn.style.display = 'block';
      eyeOff.style.display = 'none';
    }
  }

  document.getElementById('adminKeyInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') login();
  });

  // -- INIT --------------------------------------------------------
  function init() {
    updateClock();
    setInterval(updateClock, 1000);
    loadDashboard();
    showPanel('dashboard');
  }

  function getDayNum() {
    return Math.max(1, Math.ceil((Date.now() - new Date('2026-03-01').getTime()) / 86400000));
  }

  function updateClock() {
    const now = new Date();
    // Next midnight UTC
    const midnight = new Date(now);
    midnight.setUTCDate(midnight.getUTCDate() + 1);
    midnight.setUTCHours(0, 0, 0, 0);
    const diff = midnight - now;
    const h = String(Math.floor(diff / 3600000)).padStart(2, '0');
    const m = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
    const s = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
    document.getElementById('sidebarReset').textContent = `resets in ${h}:${m}:${s}`;

    const day = getDayNum();
    document.getElementById('sidebarDay').textContent = day;
    document.getElementById('statDay').textContent = day;
    document.querySelectorAll('.dash-day').forEach(el => el.textContent = day);

    // Update cycle bar
    updateCycleBar(now.getUTCHours());
  }

  function updateCycleBar(currentHour) {
    const steps = document.querySelectorAll('#cycleBar .cycle-step');
    const thresholds = [0, 0.1, 8, 8.1, 12, 18, 23];
    steps.forEach((step, i) => {
      const threshold = thresholds[i];
      step.classList.remove('active', 'done');
      if (currentHour >= threshold && (i === thresholds.length - 1 || currentHour < thresholds[i + 1])) {
        step.classList.add('active');
      } else if (currentHour > threshold) {
        step.classList.add('done');
      }
    });
  }

  // -- PANEL NAV ---------------------------------------------------
  function showPanel(id) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(`panel-${id}`).classList.add('active');
    document.getElementById(`nav-${id}`)?.classList.add('active');

    if (id === 'pending') loadEntries('pending');
    if (id === 'approved') loadEntries('approved');
    if (id === 'scheduled') loadScheduled();
    if (id === 'synthesis') loadSynthesis();
    if (id === 'decision') loadDecision();
  }

  // -- API HELPER --------------------------------------------------
  async function api(path, method = 'GET', body = null) {
    const opts = {
      method,
      headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${ADMIN_KEY}` }
    };
    if (body) opts.body = JSON.stringify(body);
    const r = await fetch(`${API}${path}`, opts);
    return r.json();
  }

  function alert_(containerId, msg, type = 'info') {
    document.getElementById(containerId).innerHTML =
      `<div class="alert alert-${type}">${msg}</div>`;
    setTimeout(() => { const el = document.getElementById(containerId); if (el) el.innerHTML = ''; }, 4000);
  }

  // -- DASHBOARD ---------------------------------------------------
  async function loadDashboard() {
    const [pending, approved, queue] = await Promise.all([
      api('/api/admin/entries?status=pending&limit=50'),
      api('/api/admin/entries?status=approved&limit=50'),
      api('/api/admin/tweets?status=approved')
    ]);
    document.getElementById('statPending').textContent = pending?.entries?.length ?? '--';
    document.getElementById('statApproved').textContent = approved?.entries?.length ?? '--';
    document.getElementById('statQueue').textContent = queue?.tweets?.length ?? '--';

    if (pending?.entries?.length > 0) {
      document.getElementById('pendingBadge').textContent = pending.entries.length;
      document.getElementById('dashboardAlerts').innerHTML =
        `<div class="alert alert-info">${pending.entries.length} journal entr${pending.entries.length === 1 ? 'y' : 'ies'} waiting for review. <button class="btn btn-respond" style="margin-left:12px" onclick="showPanel('pending')">Review</button></div>`;
    }
    document.getElementById('queueBadge').textContent = queue?.tweets?.length ?? 0;
  }

  // -- ENTRIES -----------------------------------------------------
  async function loadEntries(status) {
    const listId = status === 'pending' ? 'pendingList' : 'approvedList';
    document.getElementById(listId).innerHTML = '<div class="loading">Loading...</div>';

    const data = await api(`/api/admin/entries?status=${status}&limit=30`);
    const entries = data?.entries || [];

    if (entries.length === 0) {
      document.getElementById(listId).innerHTML = `<div class="empty">No ${status} entries.</div>`;
      return;
    }

    document.getElementById(listId).innerHTML = entries.map(e => `
      <div class="card" id="entry-${e.id}">
        <div class="card-head">
          <div class="card-meta">
            <span class="card-label tier-${e.tier}">TIER ${e.tier}${e.is_core_memory ? ' · CORE MEMORY' : ''}</span>
            <span class="card-time">${new Date(e.created_at).toLocaleTimeString()} · Day ${e.day_number}</span>
          </div>
          <div class="card-actions">
            ${status === 'pending' ? `
              <button class="btn btn-respond" onclick="generateResponse('${e.id}')">AI Response</button>
              <button class="btn btn-approve" onclick="approveEntry('${e.id}')">Approve</button>
              <button class="btn btn-reject" onclick="rejectEntry('${e.id}')">Reject</button>
            ` : `
              <button class="btn btn-delete" onclick="rejectEntry('${e.id}')">Remove</button>
            `}
          </div>
        </div>
        <div class="card-body">${escHtml(e.text)}</div>
        ${e.ai_response ? `<div class="card-response">${escHtml(e.ai_response)}</div>` : `<div class="card-response" id="resp-${e.id}" style="display:none"></div>`}
      </div>
    `).join('');
  }

  async function approveEntry(id) {
    const respEl = document.getElementById(`resp-${id}`);
    const ai_response = respEl?.textContent?.replace('BLANK -- ', '')?.trim() || null;
    await api('/api/admin/entries', 'POST', { action: 'approve', id, ai_response });
    document.getElementById(`entry-${id}`)?.remove();
    loadDashboard();
  }

  async function rejectEntry(id) {
    await api('/api/admin/entries', 'POST', { action: 'reject', id });
    document.getElementById(`entry-${id}`)?.remove();
  }

  async function generateResponse(id) {
    const btn = event.target;
    btn.disabled = true;
    btn.textContent = 'Generating...';
    const data = await api('/api/admin/entries', 'POST', { action: 'respond', id });
    if (data.ai_response) {
      const el = document.getElementById(`resp-${id}`);
      if (el) { el.textContent = data.ai_response; el.style.display = 'block'; }
    }
    btn.disabled = false;
    btn.textContent = 'AI Response';
  }

  // -- SYNTHESIS ---------------------------------------------------
  async function loadSynthesis() {
    const day = getDayNum();

    // Load current synthesis
    const synData = await api(`/api/entries/list?type=synthesis&day=${day}`);
    const synthesis = synData?.synthesis;
    const contentEl = document.getElementById('synthesisContent');

    if (synthesis && synthesis.synthesis_text) {
      contentEl.innerHTML = escHtml(synthesis.synthesis_text);
    } else {
      contentEl.innerHTML = '<span class="empty-state">No synthesis generated yet today.</span>';
    }

    // Load today's approved entries
    const entryData = await api(`/api/entries/list?type=today`);
    const entries = entryData?.entries || [];
    const listEl = document.getElementById('synthesisEntryList');

    if (entries.length === 0) {
      listEl.innerHTML = '<div class="empty">No approved entries yet today.</div>';
    } else {
      listEl.innerHTML = `<div style="color:var(--text-dim);font-size:12px;margin-bottom:12px;">${entries.length} approved entr${entries.length === 1 ? 'y' : 'ies'} today</div>` +
        entries.map(e => `<div style="padding:8px 0;border-bottom:1px solid var(--border);font-size:12px;color:var(--text);font-style:italic;">"${escHtml(e.text.slice(0, 120))}${e.text.length > 120 ? '...' : ''}"</div>`).join('');
    }
  }

  async function generateSynthesis() {
    const btn = document.getElementById('genSynthesisBtn');
    btn.disabled = true;
    btn.textContent = 'Generating...';

    const data = await api('/api/admin/synthesis', 'POST', { day: getDayNum() });
    if (data.synthesis) {
      document.getElementById('synthesisContent').innerHTML = escHtml(data.synthesis.synthesis_text || data.synthesis.text || '');
      alert_('synthesisAlert', 'Synthesis generated successfully.', 'success');
    } else {
      alert_('synthesisAlert', 'Synthesis failed: ' + (data.error || 'Unknown error'), 'error');
    }
    btn.disabled = false;
    btn.textContent = 'Generate Synthesis';
  }

  // -- DECISIONS ---------------------------------------------------
  async function loadDecision() {
    const day = getDayNum();
    const data = await api(`/api/entries/list?type=decision&day=${day}`);
    const decision = data?.decision;

    const dot = document.getElementById('decisionDot');
    const statusText = document.getElementById('decisionStatusText');
    const contentEl = document.getElementById('decisionContent');

    if (decision) {
      contentEl.innerHTML = escHtml(decision.decision_text || decision.text || '');
      document.getElementById('decisionText').value = decision.decision_text || decision.text || '';
      document.getElementById('decisionTxHash').value = decision.tx_hash || '';

      if (decision.status === 'executed') {
        dot.className = 'dot active';
        statusText.textContent = `Executed${decision.tx_hash ? ' -- tx: ' + decision.tx_hash.slice(0, 12) + '...' : ''}`;
        document.getElementById('decisionStatusSelect').value = 'executed';
      } else {
        dot.className = 'dot pending';
        statusText.textContent = 'Announced -- awaiting execution';
        document.getElementById('decisionStatusSelect').value = 'announced';
      }
    } else {
      dot.className = 'dot';
      statusText.textContent = 'No decision set for today';
      contentEl.innerHTML = '<span class="empty-state">No decision set for today.</span>';
    }
  }

  async function saveDecision() {
    const text = document.getElementById('decisionText').value.trim();
    if (!text) return alert_('decisionAlert', 'Decision text is required.', 'error');

    const tx_hash = document.getElementById('decisionTxHash').value.trim();
    const status = document.getElementById('decisionStatusSelect').value;

    const data = await api('/api/admin/synthesis', 'POST', {
      day: getDayNum(),
      type: 'decision',
      decision_text: text,
      tx_hash: tx_hash || null,
      status
    });

    if (data.error) {
      alert_('decisionAlert', 'Failed: ' + data.error, 'error');
    } else {
      alert_('decisionAlert', 'Decision saved.', 'success');
      loadDecision();
    }
  }

  // -- GENERATE TWEETS ---------------------------------------------
  async function generateTweets(type) {
    const ctx = document.getElementById(`${type}Context`)?.value?.trim() || '';
    const decision = document.getElementById(`${type}Decision`)?.value?.trim() || '';
    const result = document.getElementById(`${type}Result`)?.value?.trim() || '';
    const btn = event.target;
    btn.disabled = true;
    btn.textContent = 'Generating...';
    document.getElementById('generatedTweets').innerHTML = '<div class="loading">Generating options...</div>';

    const body = { type, count: 3, context: ctx };
    if (decision) body.decision = decision;
    if (result) body.result = result;

    const data = await api('/api/admin/generate', 'POST', body);

    if (data.tweets) {
      const typeLabel = type.replace('_', ' ');
      document.getElementById('generatedTweets').innerHTML = data.tweets.map(t => `
        <div class="tweet-card" id="tweet-${t.id}">
          <div class="tweet-card-head">
            <span class="tweet-type-badge">${typeLabel} · draft</span>
            <div style="display:flex;gap:8px;">
              <button class="btn btn-respond" onclick="editTweet('${t.id}')">Edit</button>
              <button class="btn btn-approve" onclick="approveTweet('${t.id}')">Add to Queue</button>
              <button class="btn btn-post" onclick="postTweetNow('${t.id}')">Post Now</button>
              <button class="btn btn-delete" onclick="deleteTweet('${t.id}')">X</button>
            </div>
          </div>
          <div class="tweet-card-body" id="tbody-${t.id}">${escHtml(t.text)}</div>
          <textarea class="tweet-edit" id="tedit-${t.id}" maxlength="280">${escHtml(t.text)}</textarea>
        </div>
      `).join('');
    } else {
      document.getElementById('generateAlert').innerHTML =
        `<div class="alert alert-error">${data.error || 'Generation failed'}</div>`;
      document.getElementById('generatedTweets').innerHTML = '';
    }
    btn.disabled = false;
    btn.textContent = 'Generate 3 Options';
  }

  function editTweet(id) {
    const body = document.getElementById(`tbody-${id}`);
    const edit = document.getElementById(`tedit-${id}`);
    const isEditing = edit.classList.contains('visible');
    if (isEditing) {
      body.textContent = edit.value;
      api('/api/admin/tweets', 'POST', { action: 'edit', id, text: edit.value });
    }
    body.style.display = isEditing ? 'block' : 'none';
    edit.classList.toggle('visible', !isEditing);
  }

  async function approveTweet(id) {
    await api('/api/admin/tweets', 'POST', { action: 'approve', id });
    document.getElementById(`tweet-${id}`).style.borderColor = 'var(--green)';
    document.getElementById(`tweet-${id}`).querySelector('.tweet-card-head span').textContent = 'queued';
    loadDashboard();
  }

  async function postTweetNow(id) {
    const data = await api('/api/admin/tweets', 'POST', { action: 'post', id });
    if (data.success) {
      document.getElementById(`tweet-${id}`).remove();
      alert_('generateAlert', `Posted! <a href="${data.url}" target="_blank" style="color:var(--gold)">View</a>`, 'success');
    }
  }

  async function deleteTweet(id) {
    await api('/api/admin/tweets', 'POST', { action: 'delete', id });
    document.getElementById(`tweet-${id}`)?.remove();
  }

  // -- SCHEDULED QUEUE ---------------------------------------------
  async function loadScheduled() {
    document.getElementById('scheduledList').innerHTML = '<div class="loading">Loading...</div>';
    const data = await api('/api/admin/tweets?status=approved');
    const tweets = data?.tweets || [];
    if (tweets.length === 0) {
      document.getElementById('scheduledList').innerHTML = '<div class="empty">Queue is empty. Generate some tweets first.</div>';
      return;
    }
    document.getElementById('scheduledList').innerHTML = tweets.map(t => `
      <div class="tweet-card" id="sq-${t.id}">
        <div class="tweet-card-head">
          <span class="tweet-type-badge">${(t.type || 'tweet').replace('_', ' ')}</span>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-respond" onclick="editTweet('${t.id}')">Edit</button>
            <button class="btn btn-post" onclick="postTweetNow('${t.id}')">Post Now</button>
            <button class="btn btn-delete" onclick="deleteTweet('${t.id}')">X</button>
          </div>
        </div>
        <div class="tweet-card-body" id="tbody-${t.id}">${escHtml(t.text)}</div>
        <textarea class="tweet-edit" id="tedit-${t.id}" maxlength="280">${escHtml(t.text)}</textarea>
      </div>
    `).join('');
  }

  // -- THEME -------------------------------------------------------
  function toggleTheme() {
    const isLight = document.documentElement.getAttribute('data-theme') === 'light';
    const newTheme = isLight ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('site-theme', newTheme);
    updateThemeLabel(newTheme);
  }

  function updateThemeLabel(theme) {
    const label = document.getElementById('themeLabel');
    const sun = document.getElementById('sunIcon');
    if (theme === 'light') {
      label.textContent = 'Dark Mode';
      sun.innerHTML = '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
    } else {
      label.textContent = 'Light Mode';
      sun.innerHTML = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>';
    }
  }

  (function() {
    const saved = localStorage.getItem('site-theme');
    if (saved) {
      document.documentElement.setAttribute('data-theme', saved);
      updateThemeLabel(saved);
    }
  })();

  // -- UTILS -------------------------------------------------------
  function escHtml(s) {
    return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }
</script>
</body>
</html>
